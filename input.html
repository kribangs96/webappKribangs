<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Input Aktivitas Harian - Kribangs</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background-color: #fffbe6; }
    label { display: block; margin-top: 15px; font-weight: bold; }
    input, textarea, select {
      width: 100%; padding: 10px; margin-top: 5px;
      border: 1px solid #ccc; border-radius: 5px; font-size: 14px;
    }
    button {
      background-color: #f7a324; color: white; padding: 10px 20px;
      border: none; border-radius: 5px; cursor: pointer;
      margin-top: 20px; font-size: 16px;
    }
    button:hover { background-color: #d9821b; }
    h2 { color: #f7a324; }
  </style>
</head>
<body>
  <h2>Input Aktivitas Harian + Upload Gambar</h2>
  <form id="aktivitasForm">
    <label for="tanggal">Tanggal</label>
    <input type="date" id="tanggal" required />

    <label for="divisi">Divisi</label>
    <select id="divisi" required>
      <option value="">-- Pilih Divisi --</option>
      <option>Operasional Kribangs</option>
      <option>Operasional Cemilan</option>
      <option>Finance</option>
      <option>HRD</option>
      <option>Kanvas/Kampas</option>
    </select>

    <label for="nama">Nama PIC</label>
    <input type="text" id="nama" required />

    <label for="aktivitas">Aktivitas</label>
    <textarea id="aktivitas" required></textarea>

    <label for="status">Status</label>
    <select id="status" required>
      <option value="Selesai">Selesai</option>
      <option value="Belum Selesai">Belum Selesai</option>
    </select>

    <label for="kendala">Kendala</label>
    <textarea id="kendala"></textarea>

    <label for="solusi">Solusi</label>
    <textarea id="solusi"></textarea>

    <label for="output">Upload Gambar (opsional)</label>
    <input type="file" id="output" accept="image/*" />

    <button type="submit">Kirim</button>
  </form>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.7.3/firebase-app.js";
    import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/11.7.3/firebase-firestore.js";
    import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/11.7.3/firebase-storage.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDg_kAV0ebhCX35LVw8Hga_iZhpm0YIDbM",
      authDomain: "laporanharian-kribangs.firebaseapp.com",
      projectId: "laporanharian-kribangs",
      storageBucket: "laporanharian-kribangs.appspot.com",
      messagingSenderId: "268157689694",
      appId: "1:268157689694:web:0623020c6582c1a25d79cf",
      measurementId: "G-KP9L2BTNZ0"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const storage = getStorage(app);

    document.getElementById("aktivitasForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const fileInput = document.getElementById("output");
      let fileUrl = "";

      if (fileInput.files.length > 0) {
        const file = fileInput.files[0];
        const storageRef = ref(storage, 'uploads/' + Date.now() + '_' + file.name);
        const snapshot = await uploadBytes(storageRef, file);
        fileUrl = await getDownloadURL(snapshot.ref);
      }

      const data = {
        tanggal: document.getElementById("tanggal").value,
        divisi: document.getElementById("divisi").value,
        nama: document.getElementById("nama").value,
        aktivitas: document.getElementById("aktivitas").value,
        status: document.getElementById("status").value,
        kendala: document.getElementById("kendala").value,
        solusi: document.getElementById("solusi").value,
        output: fileUrl
      };

      await addDoc(collection(db, "aktivitas"), data);
      alert("Laporan berhasil dikirim!");
      e.target.reset();
    });
  </script>
</body>
</html>
